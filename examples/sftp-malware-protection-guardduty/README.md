<!-- BEGIN_TF_DOCS -->
# SFTP Server with GuardDuty Malware Protection Example

This example demonstrates how to deploy an AWS Transfer Family SFTP server with integrated GuardDuty malware protection. Files uploaded to the server are automatically scanned for malware, and any infected files are quarantined to a separate S3 bucket.

## Key Features

- **SFTP Server**: Fully configured Transfer Family SFTP server with service-managed users
- **Malware Protection**: GuardDuty malware protection plan for automatic file scanning
- **Auto-Quarantine**: Lambda function automatically moves infected files to quarantine bucket
- **Event-Driven**: EventBridge integration for real-time malware detection response
- **Secure Storage**: KMS-encrypted S3 buckets with versioning and public access blocking

## What Gets Deployed

- AWS Transfer Family SFTP server
- S3 bucket for file storage (with KMS encryption)
- S3 quarantine bucket (automatically created)
- GuardDuty malware protection plan
- Lambda function for file quarantine
- EventBridge rule for malware detection events
- IAM roles and policies for secure access

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.5 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 5.95.0 |
| <a name="requirement_random"></a> [random](#requirement\_random) | >= 3.0.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | >= 5.95.0 |
| <a name="provider_random"></a> [random](#provider\_random) | >= 3.0.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_guardduty_malware_protection"></a> [guardduty\_malware\_protection](#module\_guardduty\_malware\_protection) | ../../modules/transfer-malware-protection | n/a |

## Resources

| Name | Type |
|------|------|
| [aws_s3_bucket.quarantine](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket) | resource |
| [aws_s3_bucket_public_access_block.quarantine](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block) | resource |
| [aws_s3_bucket_server_side_encryption_configuration.quarantine](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_server_side_encryption_configuration) | resource |
| [aws_s3_bucket_versioning.quarantine](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_versioning) | resource |
| [random_pet.quarantine_suffix](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/pet) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_existing_bucket_name"></a> [existing\_bucket\_name](#input\_existing\_bucket\_name) | Name of the existing SFTP S3 bucket to protect | `string` | n/a | yes |
| <a name="input_existing_kms_key_arn"></a> [existing\_kms\_key\_arn](#input\_existing\_kms\_key\_arn) | ARN of the existing KMS key used for S3 bucket encryption | `string` | n/a | yes |
| <a name="input_aws_region"></a> [aws\_region](#input\_aws\_region) | AWS region | `string` | `"us-east-1"` | no |
| <a name="input_name_prefix"></a> [name\_prefix](#input\_name\_prefix) | Prefix for resource names | `string` | `"sftp-malware-protection"` | no |
| <a name="input_object_prefixes"></a> [object\_prefixes](#input\_object\_prefixes) | List of S3 object prefixes to scan (empty list scans all objects) | `list(string)` | `[]` | no |
| <a name="input_quarantine_bucket_prefix"></a> [quarantine\_bucket\_prefix](#input\_quarantine\_bucket\_prefix) | Prefix for the quarantine bucket name (random suffix will be added) | `string` | `"sftp-quarantine"` | no |
| <a name="input_tags"></a> [tags](#input\_tags) | Tags to apply to resources | `map(string)` | <pre>{<br/>  "Environment": "Production",<br/>  "Purpose": "SFTP Malware Protection"<br/>}</pre> | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_guardduty_role_arn"></a> [guardduty\_role\_arn](#output\_guardduty\_role\_arn) | ARN of the GuardDuty IAM role |
| <a name="output_malware_protection_plan_arn"></a> [malware\_protection\_plan\_arn](#output\_malware\_protection\_plan\_arn) | ARN of the GuardDuty malware protection plan |
| <a name="output_quarantine_bucket_name"></a> [quarantine\_bucket\_name](#output\_quarantine\_bucket\_name) | Name of the created quarantine S3 bucket |
| <a name="output_quarantine_function_arn"></a> [quarantine\_function\_arn](#output\_quarantine\_function\_arn) | ARN of the quarantine Lambda function |
<!-- END_TF_DOCS -->