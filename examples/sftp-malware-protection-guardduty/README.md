<!-- BEGIN_TF_DOCS -->
# SFTP Server with GuardDuty Malware Protection Example

This example demonstrates how to deploy an AWS Transfer Family SFTP server with integrated GuardDuty malware protection. Files uploaded to the server are automatically scanned for malware, and any infected files are quarantined to a separate S3 bucket.

## Key Features

- **SFTP Server**: Fully configured Transfer Family SFTP server with service-managed users
- **Malware Protection**: GuardDuty malware protection plan for automatic file scanning
- **Auto-Quarantine**: Lambda function automatically moves infected files to quarantine bucket
- **Event-Driven**: EventBridge integration for real-time malware detection response
- **Secure Storage**: KMS-encrypted S3 buckets with versioning and public access blocking

## What Gets Deployed

- AWS Transfer Family SFTP server
- S3 bucket for file storage (with KMS encryption)
- S3 quarantine bucket (automatically created)
- GuardDuty malware protection plan
- Lambda function for file quarantine
- EventBridge rule for malware detection events
- IAM roles and policies for secure access

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.5 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 5.95.0 |
| <a name="requirement_random"></a> [random](#requirement\_random) | >= 3.0.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_random"></a> [random](#provider\_random) | >= 3.0.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_guardduty_malware_protection"></a> [guardduty\_malware\_protection](#module\_guardduty\_malware\_protection) | ../../modules/transfer-malware-protection | n/a |
| <a name="module_s3_bucket_clean"></a> [s3\_bucket\_clean](#module\_s3\_bucket\_clean) | git::https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git | v5.0.0 |
| <a name="module_s3_bucket_errors"></a> [s3\_bucket\_errors](#module\_s3\_bucket\_errors) | git::https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git | v5.0.0 |
| <a name="module_s3_bucket_quarantine"></a> [s3\_bucket\_quarantine](#module\_s3\_bucket\_quarantine) | git::https://github.com/terraform-aws-modules/terraform-aws-s3-bucket.git | v5.0.0 |
| <a name="module_sftp-public-endpoint-service-managed-S3-resources"></a> [sftp-public-endpoint-service-managed-S3-resources](#module\_sftp-public-endpoint-service-managed-S3-resources) | ../sftp-public-endpoint-service-managed-S3 | n/a |

## Resources

| Name | Type |
|------|------|
| [random_pet.name](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/pet) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_aws_region"></a> [aws\_region](#input\_aws\_region) | AWS region | `string` | `"us-east-1"` | no |
| <a name="input_clean_prefix"></a> [clean\_prefix](#input\_clean\_prefix) | S3 prefix for clean files | `string` | `null` | no |
| <a name="input_create_kms_key_for_lambda_sqs"></a> [create\_kms\_key\_for\_lambda\_sqs](#input\_create\_kms\_key\_for\_lambda\_sqs) | Whether to create a KMS key for Lambda and SQS encryption | `bool` | `false` | no |
| <a name="input_create_sqs_dlq"></a> [create\_sqs\_dlq](#input\_create\_sqs\_dlq) | Whether to create an SQS dead letter queue | `bool` | `false` | no |
| <a name="input_create_test_user"></a> [create\_test\_user](#input\_create\_test\_user) | Whether to create a test user | `bool` | `true` | no |
| <a name="input_delete_processed_file_from_ingest_bucket"></a> [delete\_processed\_file\_from\_ingest\_bucket](#input\_delete\_processed\_file\_from\_ingest\_bucket) | Whether to delete the file in the ingest bucket after scanning (true) or retain them (false) | `bool` | `false` | no |
| <a name="input_enable_sqs_buffer"></a> [enable\_sqs\_buffer](#input\_enable\_sqs\_buffer) | Enable SQS buffer between EventBridge and Lambda for improved reliability | `bool` | `true` | no |
| <a name="input_error_prefix"></a> [error\_prefix](#input\_error\_prefix) | S3 prefix for error files | `string` | `null` | no |
| <a name="input_name_prefix"></a> [name\_prefix](#input\_name\_prefix) | Prefix for resource names | `string` | `"sftp-malware-protection"` | no |
| <a name="input_quarantine_prefix"></a> [quarantine\_prefix](#input\_quarantine\_prefix) | S3 prefix for quarantined files | `string` | `null` | no |
| <a name="input_tags"></a> [tags](#input\_tags) | Tags to apply to resources | `map(string)` | <pre>{<br/>  "Environment": "Production",<br/>  "Purpose": "SFTP Malware Protection"<br/>}</pre> | no |
| <a name="input_users_file"></a> [users\_file](#input\_users\_file) | Path to CSV file containing user definitions | `string` | `"users.csv"` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_clean_bucket_name"></a> [clean\_bucket\_name](#output\_clean\_bucket\_name) | Name of the created clean S3 bucket |
| <a name="output_error_bucket_name"></a> [error\_bucket\_name](#output\_error\_bucket\_name) | Name of the created error S3 bucket |
| <a name="output_guardduty_role_arn"></a> [guardduty\_role\_arn](#output\_guardduty\_role\_arn) | ARN of the GuardDuty IAM role |
| <a name="output_malware_protection_plan_arn"></a> [malware\_protection\_plan\_arn](#output\_malware\_protection\_plan\_arn) | ARN of the GuardDuty malware protection plan |
| <a name="output_quarantine_bucket_name"></a> [quarantine\_bucket\_name](#output\_quarantine\_bucket\_name) | Name of the created quarantine S3 bucket |
| <a name="output_quarantine_function_arn"></a> [quarantine\_function\_arn](#output\_quarantine\_function\_arn) | ARN of the quarantine Lambda function |
| <a name="output_sftp_server_endpoint"></a> [sftp\_server\_endpoint](#output\_sftp\_server\_endpoint) | SFTP server endpoint |
| <a name="output_sqs_queue_arn"></a> [sqs\_queue\_arn](#output\_sqs\_queue\_arn) | ARN of the SQS queue for GuardDuty events |
<!-- END_TF_DOCS -->